<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Todo App</title>
<style>
    li { margin-bottom: 10px; }
    button { margin-left: 5px; }
</style>
</head>
<body>

<h1>Todo App</h1>
<input type="text" id="taskInput" placeholder="Add task">
<button id="addBtn">Add</button>

<ul id="taskList"></ul>

<script>
const API_URL = 'http://localhost:3000/tasks';
const taskList = document.getElementById('taskList');
const taskInput = document.getElementById('taskInput');
const addBtn = document.getElementById('addBtn');

// Load tasks from backend
async function loadTasks() {
    const res = await fetch(API_URL);
    const tasks = await res.json();
    taskList.innerHTML = '';
    tasks.forEach(task => {
        addTaskToDOM(task);
    });
}

// Add task to DOM
function addTaskToDOM(task) {
    const li = document.createElement('li');
    li.textContent = task.text;
    li.dataset.id = task.id;

    // Edit button
    const editBtn = document.createElement('button');
    editBtn.textContent = 'Edit';
    editBtn.onclick = () => editTask(task.id, li);

    // Delete button
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'Delete';
    deleteBtn.onclick = () => deleteTask(task.id);

    li.appendChild(editBtn);
    li.appendChild(deleteBtn);
    taskList.appendChild(li);
}

// Add new task
addBtn.onclick = async () => {
    const text = taskInput.value.trim();
    if (!text) return alert('Task cannot be empty');

    const res = await fetch(API_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ text })
    });
    const newTask = await res.json();
    addTaskToDOM(newTask);
    taskInput.value = '';
};

// Edit task
async function editTask(id, liElement) {
    const newText = prompt('Edit task:', liElement.firstChild.textContent);
    if (newText === null) return; // user cancelled

    const res = await fetch(`${API_URL}/${id}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ text: newText })
    });
    const updatedTask = await res.json();
    liElement.firstChild.textContent = updatedTask.text;
}

// Delete task
async function deleteTask(id) {
    await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
    loadTasks();
}

// Initial load
loadTasks();
</script>

</body>
</html>
